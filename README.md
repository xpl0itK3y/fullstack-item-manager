# Full-stack Item Manager

Full-stack приложение для управления списком из 1 млн элементов с drag-and-drop сортировкой, инфинити-скроллом и фильтрацией. Vue.js + Express.js + Docker.

## Основной функционал

- **Двухпанельный интерфейс** - доступные элементы слева, выбранные справа
- **1 000 000+ элементов** - эффективная работа с большими объемами данных
- **Drag & Drop сортировка** - перетаскивание элементов в правом окне для изменения порядка
- **Инфинити-скролл** - плавная подгрузка по 20 элементов при прокрутке
- **Фильтрация по ID** - мгновенный поиск в обоих окнах
- **Батчинг запросов** - оптимизированная обработка с дедупликацией
- **Сохранение состояния** - выбор и порядок сохраняются на сервере
- **Оптимистичные обновления** - мгновенный отклик интерфейса
- **Docker готово** - один команда для запуска всего проекта

## Технологии

**Frontend:** Vue 3, Composition API, Vite, Axios, vuedraggable  
**Backend:** Express.js, in-memory хранилище, система очередей  
**DevOps:** Docker, Docker Compose

## Требования

- Docker & Docker Compose
- (Опционально) Node.js 20+ для локальной разработки

## Быстрый старт

### Запуск через Docker (рекомендуется)

```bash
# Клонируйте репозиторий
git clone https://github.com/yourusername/fullstack-item-manager.git
cd fullstack-item-manager

# Запустите приложение
docker-compose up -d --build

# Приложение будет доступно:
# Frontend: http://localhost:5173
# Backend API: http://localhost:3000
```

### Локальная разработка

**Backend:**
```bash
cd backend
npm install
npm run dev
# Запустится на http://localhost:3000
```

**Frontend:**
```bash
cd frontend
npm install
npm run dev
# Запустится на http://localhost:5173
```

## Структура проекта

```
fullstack-item-manager/
├── backend/
│   ├── src/
│   │   ├── server.js           # Главный файл сервера
│   │   ├── routes/
│   │   │   └── items.js        # API endpoints
│   │   ├── services/
│   │   │   └── itemService.js  # Бизнес-логика
│   │   └── utils/
│   │       └── queue.js        # Система очередей
│   ├── Dockerfile
│   └── package.json
├── frontend/
│   ├── src/
│   │   ├── App.vue                      # Главный компонент
│   │   ├── components/
│   │   │   ├── ItemList.vue             # Список доступных элементов
│   │   │   └── SelectedItemList.vue     # Список с drag-and-drop
│   │   └── services/
│   │       └── api.js                   # API клиент
│   ├── Dockerfile
│   └── package.json
├── docker-compose.yml
└── README.md
```

## API Endpoints

### Items Management

| Метод | Endpoint | Описание | Параметры |
|-------|----------|----------|-----------|
| GET | `/api/items/available` | Получить доступные элементы | `page`, `limit`, `search` |
| GET | `/api/items/selected` | Получить выбранные элементы | `page`, `limit`, `search` |
| POST | `/api/items/select` | Добавить в выбранные | `{ id: number }` |
| POST | `/api/items/deselect` | Удалить из выбранных | `{ id: number }` |
| POST | `/api/items/reorder` | Изменить порядок | `{ items: array }` |
| POST | `/api/items/add` | Добавить новый элемент | `{ id: number }` |

### Примеры запросов

```bash
# Получить первую страницу доступных элементов
curl "http://localhost:3000/api/items/available?page=1&limit=20"

# Поиск по ID
curl "http://localhost:3000/api/items/available?search=123"

# Выбрать элемент
curl -X POST http://localhost:3000/api/items/select \
  -H "Content-Type: application/json" \
  -d '{"id": 42}'
```

## Особенности реализации

### Батчинг запросов

Для оптимизации производительности используется система очередей с батчингом:

- **Добавление новых элементов:** обработка раз в 10 секунд
- **Выбор/удаление/сортировка:** обработка раз в 1 секунду
- **Дедупликация:** исключение повторных запросов в очереди

```javascript
// Пример работы батчинга
00:00 - Пользователь добавил элемент ID 100001 → в очередь
00:03 - Пользователь добавил элемент ID 100002 → в очередь
00:10 - Оба элемента обработаны одной операцией
```

### Оптимистичные обновления

UI обновляется мгновенно, не дожидаясь ответа сервера:

- Клик на элемент → **моментально** перемещается в другое окно
- Drag & Drop → порядок меняется **моментально**
- Если ошибка на сервере → изменения откатываются

### Инфинити-скролл

- Начальная загрузка: 20 элементов
- Подгрузка при скролле: порциями по 20
- Работает для поиска и обычного просмотра
- Виртуализация для плавной прокрутки

### Сохранение состояния

- Выбранные элементы хранятся в памяти сервера
- Порядок сортировки сохраняется
- При перезагрузке страницы состояние восстанавливается
- Поиск НЕ сохраняется (по требованию ТЗ)

## Docker команды

```bash
# Запуск
docker-compose up -d

# Запуск с пересборкой
docker-compose up -d --build

# Просмотр логов
docker-compose logs -f

# Остановка
docker-compose down

# Перезапуск
docker-compose restart

# Удаление с volumes
docker-compose down -v
```

## Производительность

- **Хранение:** 1 000 000 элементов ≈ 100MB RAM
- **Начальная загрузка:** < 2 секунды
- **Добавление элемента:** мгновенно (UI) + 10 сек (сервер)
- **Выбор/удаление:** мгновенно (UI) + 1 сек (сервер)
- **Поиск:** < 100ms
- **Батчинг:** снижает нагрузку на 90%

## Использование

### Добавление нового элемента

1. Введите ID в поле вверху
2. Нажмите "Добавить элемент"
3. Синее уведомление: "Элемент добавлен в очередь..."
4. Через 10 секунд элемент появится в левом окне

### Выбор элемента

1. Нажмите на элемент в левом окне
2. Элемент мгновенно переместится в правое окно
3. Изменения сохранятся на сервере

### Сортировка элементов

1. В правом окне захватите элемент за иконку `⋮⋮`
2. Перетащите на нужное место
3. Отпустите - порядок сохранится

### Поиск по ID

1. Введите ID или часть ID в поле поиска
2. Список отфильтруется мгновенно
3. Инфинити-скролл работает для результатов поиска

## Конфигурация

### Backend (`.env`)

```env
PORT=3000
NODE_ENV=development
```

### Frontend (`.env`)

```env
VITE_API_URL=http://localhost:3000
```

### Docker Compose

Порты и volumes настраиваются в `docker-compose.yml`:

```yaml
services:
  backend:
    ports:
      - "3000:3000"
  frontend:
    ports:
      - "5173:5173"
```

## Деплой

Приложение готово к деплою на:

- **Render** - автоматический деплой из Git
- **Railway** - полная поддержка Docker Compose
- **DigitalOcean** - App Platform или Droplet
- **AWS ECS** - контейнерный сервис
- **Google Cloud Run** - serverless контейнеры

Пример для Railway:

```bash
# Установите Railway CLI
npm install -g @railway/cli

# Войдите в аккаунт
railway login

# Создайте проект
railway init

# Задеплойте
railway up
```

## Примечания

- **In-memory хранилище:** данные живут пока работает сервер
- **Общее состояние:** все пользователи видят одни и те же данные

## Troubleshooting

### Frontend не запускается

```bash
# Проверьте версию Node.js (нужна 20+)
node --version

# Пересоберите образ
docker-compose build frontend --no-cache
```

### Backend не видит изменения

```bash
# Перезапустите контейнер
docker-compose restart backend

# Проверьте логи
docker-compose logs -f backend
```

### Белый экран

```bash
# Проверьте консоль браузера (F12)
# Убедитесь что axios установлен
cd frontend && npm install axios
```

## Лицензия

MIT
